<font face="Simsun" size=3>

### 几种模式

- [参考](https://zhuanlan.zhihu.com/p/257845445?utm_source=wechat_session)

#### 主从 sentinel.conf

- 优点:
  - master能自动将数据同步到slave，可以进行读写分离，分担master的读压力
  - slave可以接受其他slave的同步请求，分担主节点压力
  - 主节点以非阻塞的方式为slave提供服务，所以在同步期间，客户端仍然可以提交查询或修改请求
  - slave是以非阻塞方式数据同步，同步期间，返回同步之前的数据
- 缺点:     
  - 不具备容错和恢复功能，主机从机的宕机都会导致前段部分读写请求失败
  - 主机宕机，宕机前未同步的数据，切换ip后会导致数据不一致
  - 难以在线扩容，取决于单机的上限
                 

#### 哨兵 基于主从复制

 高可用，读写分离

- 优点:
  - 哨兵模式是基于主从模式的，所有主从的优点，哨兵模式都具有
  - 主从可以自动切换  
- 缺点: 
  - 较难支持在线扩容，在集群容量上限时在线扩容会变得很复杂

#### 集群(直连)

Redis-Cluster采用无中心结构,它的特点如下：

- 优点:     
  - 节点间(Ping-Pong机制),二进制协议，传输速度快
  - 无中心结构，链接任意一个节点即可
  - 节点的fail是通过集群中超过半数的节点检测失败时才生效
  - 支持扩容
  -  
      1、资源隔离型较差，容易出现相互影响的情况。
      2、数据通过异步复制，不保证数据的一致性。

---

- 数据同步
1. 如果设置了一个Slave，无论是第一次连接还是重连到Master，它都会发出一个SYNC命令；
2. 当Master收到SYNC命令之后，会做两件事：
a) Master执行BGSAVE，即在后台保存数据到磁盘（rdb快照文件）；
b) Master同时将新收到的写入和修改数据集的命令存入缓冲区（非查询类）；
3. 当Master在后台把数据保存到快照文件完成之后，Master会把这个快照文件传送给Slave，而Slave则把内存清空后，加载该文件到内存中；
4. 而Master也会把此前收集到缓冲区中的命令，通过Reids命令协议形式转发给Slave，Slave执行这些命令，实现和Master的同步；
5. Master/Slave此后会不断通过异步方式进行命令的同步，达到最终数据的同步一致；
6. 需要注意的是Master和Slave之间一旦发生重连都会引发全量同步操作。但在2.8之后版本，也可能是部分同步操作。


</font>